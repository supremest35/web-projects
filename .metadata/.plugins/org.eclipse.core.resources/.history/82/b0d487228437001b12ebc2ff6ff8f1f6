package dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import util.ConnectionUtil;
import vo.Board;
import vo.BoardImage;

public class BoardDao {

	private static final String GET_BOARD_NO_SQL = "select test_board_seq.nextval no from dual";
	private static final String INSERT_BOARD_SQL = "insert into test_board (board_no, board_title, board_document, user_id)"
			+ " values (?, ?, ?, ?)";
	private static final String INSERT_BOARD_IMAGE_SQL = "insert into test_board_images (board_no, image_filename, image_index)"
			+ " values (?, ?, ?)";
	
	// 싱글턴 객체
	private static final BoardDao boardDao = new BoardDao();
	private BoardDao() {}
	public static BoardDao getInstance() {
		return boardDao;
	}
	
	public int getBoardNo() throws SQLException {
		int boardNo = 0;
		
		Connection con = ConnectionUtil.getConnection();
		PreparedStatement pstmt = con.prepareStatement(GET_BOARD_NO_SQL);
		ResultSet rs = pstmt.executeQuery();
		
		rs.next();
		
		boardNo = rs.getInt("no");
		
		return boardNo;
		
	}
	
	public void insertBoard(Board board) throws SQLException {
		
		Connection con = ConnectionUtil.getConnection();
		PreparedStatement pstmt = con.prepareStatement(INSERT_BOARD_SQL);
		pstmt.setInt(1, board.getNo());
		pstmt.setString(2, board.getTitle());
		pstmt.setString(3, board.getDocument());
		pstmt.setString(4, board.getUserId());
		pstmt.executeUpdate();
		
		pstmt.close();
		con.close();
	}
	
	public void insertBoardImage(BoardImage boardImage) throws SQLException {
		Connection con = ConnectionUtil.getConnection();
		PreparedStatement pstmt = con.prepareStatement(INSERT_BOARD_IMAGE_SQL);
		pstmt.setInt(1, boardImage.getNo());
		pstmt.setString(2, boardImage.getFileName());
		pstmt.setInt(3, boardImage.getIndex());
		pstmt.executeUpdate();
		
		pstmt.close();
		con.close();
	}
	
}
